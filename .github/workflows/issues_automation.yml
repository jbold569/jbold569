name: Orchestrate Issue triggered workflows based on labels
on:
  issues:
    types: [assigned]

jobs:
  issue_assigned:
    name: Issue Assigned
    
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.8]

    steps:

      - name: Blog Post Issue Checkout main
        if: ${{github.event.issue.labels[0].name == 'documentation.blog'}}
        env:
          BLOG_CONFIG: ${{github.event.issue.body}}
        uses: actions/checkout@v2
      
      - name: Create new Branch
        run: |
          git checkout -b blog/iss${{github.event.issue.number}}
          
      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: ${{matrix.python-version}}
      
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt 
      
      - name: Generate Blog Entry and Clean Up
        run: |
          echo "${{env.BLOG_CONFIG}}" > config.yml
          cat config.yml
          cd src
          python -m profile_builder blog -t ./templates -o ../docs/blog -c ../config.yml -v
          cd ..
          rm config.yml
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add .
          git commit -m "generated iss${{github.event.issue.number}}"
          git push --set-upstream origin blog/iss${{github.event.issue.number}}
