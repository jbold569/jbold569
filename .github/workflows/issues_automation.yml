name: Orchestrate Issue triggered workflows based on labels
on:
  issues:
    types: [assigned]

jobs:
  blog_issue_assigned:
    if: ${{github.event.issue.labels[0].name == 'documentation.blog'}}
    name: Blog Issue Assigned
    
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.8]
    env:
      BRANCH_NAME: blog/issue${{github.event.issue.number}}
    steps:
      - name: Blog Post Issue Checkout main
        uses: actions/checkout@v2
      
      - name: Create new Blog Branch
        run: |
          git checkout -b ${{BRANCH_NAME}}
          
      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: ${{matrix.python-version}}
      
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt 
      
      - name: Generate Blog Entry and Clean Up
        run: |
          echo "${{github.event.issue.body}}" > src/config.yml
          cat src/config.yml
          cd src
          python -m profile_builder blog -t ./templates -o ../docs/blog -c ./config.yml -v
          rm config.yml
          cd ..
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add .
          git commit -m "generated ${{BRANCH_NAME}}"
          git push --set-upstream origin ${{BRANCH_NAME}}    